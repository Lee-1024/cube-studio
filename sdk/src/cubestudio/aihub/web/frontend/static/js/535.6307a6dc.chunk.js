"use strict";(self.webpackChunkcbapp_frontend=self.webpackChunkcbapp_frontend||[]).push([[535],{27437:function(e,n,t){t.r(n),t.d(n,{default:function(){return me}});var a=t(93433),r=t(4942),i=t(1413),c=t(29439),o=t(4519),l=t(10388),s=t(20011),u=t(42496),d=t(82574),f=t(10089),m=t(96874),p=t(1140),h=t(1449),Z=t(93849),v=t(35492),x=t(2704),j=t(12513),g=t(82085),y=t(37167),b=t(72577),S=t(2556),_=b.Z.Title,k=function(e){var n={position:"sticky",top:0};return(0,S.jsxs)(v.Z,{className:"title-header",justify:"space-between",align:"middle",style:e.noBorderBottom?(0,i.Z)({borderBottom:"none"},n):n,children:[(0,S.jsxs)("div",{children:[(0,S.jsx)(_,{className:"d-il mr12",level:5,style:{marginBottom:10},children:e.title}),(0,S.jsx)("div",{className:"d-il",children:e.breadcrumbs})]}),(0,S.jsx)(x.Z,{children:(0,S.jsx)(s.Z,{children:e.children?e.children:null})})]})},w=t(44925),C=t(28532),N=t(90575),O=t(25738),P=t(44745),I=t(602),T=t(24520),E=t.n(T),M=t(74308),z=["onResize","width"],F=t(17972),H=function(){return(0,S.jsxs)(v.Z,{justify:"center",align:"middle",style:{height:360,flexDirection:"column"},children:[(0,S.jsx)("img",{src:I,style:{width:266},alt:""}),(0,S.jsx)("div",{children:"\u6682\u65e0\u6570\u636e"})]})},V=function(e){var n=e.onResize,t=e.width,a=(0,w.Z)(e,z);return t?(0,S.jsx)(M.Resizable,{width:t,height:0,handle:(0,S.jsx)("span",{className:"react-resizable-handle",onClick:function(e){e.stopPropagation()}}),onResize:n,draggableOpts:{enableUserSelectHack:!1},children:(0,S.jsx)("th",(0,i.Z)((0,i.Z)({},a),{},{style:(0,i.Z)((0,i.Z)({},null===a||void 0===a?void 0:a.style),{},{userSelect:"none"})}))}):(0,S.jsx)("th",(0,i.Z)({},a))},R=function(e){var n=(0,o.useState)(!1),t=(0,c.Z)(n,2),r=t[0],l=t[1],u=(0,o.useState)({header:[],data:[]}),d=(0,c.Z)(u,2),p=d[0],h=d[1],Z=(0,o.useState)([]),g=(0,c.Z)(Z,2),y=g[0],b=g[1],_=(0,o.useState)(e.columns),k=(0,c.Z)(_,2),w=k[0],I=k[1],T=function(n){return function(t,r){var c=r.size;if(!(c.width<100)){var o=(0,a.Z)(w);o[n]=(0,i.Z)((0,i.Z)({},o[n]),{},{width:c.width});var l=o.reduce((function(e,n){return e+n.width||100}),0)+200;localStorage.setItem(e.tableKey||"",JSON.stringify(o)),J((0,i.Z)((0,i.Z)({},D),{},{x:l})),I(o)}}},M=w.map((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},{width:e.width||200,onHeaderCell:function(e){return{width:e.width,onResize:T(n)}}})})),z=(0,o.useState)(e.scroll),R=(0,c.Z)(z,2),D=R[0],J=R[1];(0,o.useEffect)((function(){I(e.columns)}),[e.columns]),(0,o.useEffect)((function(){J(e.scroll)}),[e.scroll]),(0,o.useEffect)((function(){if(e.dataSource){var n=e.columns.filter((function(e){return~y.indexOf(e.dataIndex)}));L(n,e.dataSource)}}),[e.dataSource,e.columns]);var L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,t=e.map((function(e){return e.dataIndex})).filter((function(e){return"handle"!==e})),a=e.map((function(e){return e.title})).filter((function(e){return"\u64cd\u4f5c"!==e})),r=[];n.forEach((function(e){var n={};t.map((function(t){var a=e[t];n[t]=a||""})),r.push(n)})),h({header:a,data:r})},K=function(){var e=p.header,n=p.data,t="";return e.length&&n.length?(t="|"+e.join("|")+"|\n",n.forEach((function(e){var n=Object.values(e).map((function(e){return""===e?" ":e}));t=t+"|"+n.join("|")+"|\n"}))):t="",t},Y=function(){var e=p.header,n=p.data,t="";return e.length&&n.length?(t=e.join("\t")+"\n",n.forEach((function(e){var n=Object.values(e).map((function(e){return""===e?" ":e}));t=t+n.join("\t")+"\n"}))):t="",t};return(0,S.jsxs)(s.Z,{className:"tablebox",direction:"vertical",size:"middle",children:[(0,S.jsxs)(m.Z,{width:1e3,maskClosable:!1,centered:!0,bodyStyle:{maxHeight:500,overflow:"auto"},visible:r,title:"\u5bfc\u51fa\u6570\u636e",onCancel:function(){l(!1)},footer:null,children:[(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsxs)("div",{className:"mb16",children:[(0,S.jsx)("span",{className:"pr8",children:"\u9009\u62e9\u9700\u8981\u5bfc\u51fa\u7684\u5217\uff1a"}),(0,S.jsx)(C.Z.Group,{options:e.columns.map((function(e){return{label:e.title,value:e.dataIndex}})).filter((function(e){return"handle"!==e.value})),defaultValue:[],value:y,onChange:function(n){b(n);var t=e.columns.filter((function(e){return~n.indexOf(e.dataIndex)}));L(t,e.dataSource)}})]}),(0,S.jsxs)("div",{style:{position:"absolute",right:0,bottom:0},children:[(0,S.jsx)(j.Z,{size:"small",type:"link",onClick:function(){b(e.columns.map((function(e){return e.dataIndex})).filter((function(e){return"handle"!==e}))),L(e.columns,e.dataSource)},children:"\u5168\u9009"}),(0,S.jsx)(j.Z,{size:"small",type:"link",onClick:function(){b([]),L([],e.dataSource)},children:"\u53cd\u9009"})]})]}),(0,S.jsxs)(N.Z,{children:[(0,S.jsx)(N.Z.TabPane,{tab:"Wiki\u683c\u5f0f",children:(0,S.jsx)(F,{text:K(),onCopy:function(){return f.ZP.success("\u5df2\u590d\u5236\u5230\u7c98\u8d34\u677f")},children:(0,S.jsx)("pre",{style:{cursor:"pointer",minHeight:100},children:(0,S.jsx)("code",{children:K()})})})},"jira"),(0,S.jsx)(N.Z.TabPane,{tab:"Text\u683c\u5f0f",children:(0,S.jsx)(F,{text:Y(),onCopy:function(){return f.ZP.success("\u5df2\u590d\u5236\u5230\u7c98\u8d34\u677f")},children:(0,S.jsx)("pre",{style:{cursor:"pointer",minHeight:100},children:(0,S.jsx)("code",{children:Y()})})})},"test"),(0,S.jsx)(N.Z.TabPane,{tab:"Excel\u683c\u5f0f",children:(0,S.jsx)(v.Z,{justify:"center",align:"middle",style:{minHeight:100},children:(0,S.jsx)(x.Z,{children:(0,S.jsx)(j.Z,{type:"primary",onClick:function(){var e={fileName:"result"};e.datas=[{sheetData:p.data,sheetName:"sheet",sheetHeader:p.header}],new(E())(e).saveExcel()},children:"\u5bfc\u51faExcel"})})})},"excel")]})]}),e.titleNode||e.buttonNode||!e.cancelExportData?(0,S.jsxs)(v.Z,{justify:"space-between",align:"middle",children:[(0,S.jsx)(x.Z,{children:(0,S.jsx)(s.Z,{align:"center",children:e.titleNode})}),(0,S.jsx)(x.Z,{children:(0,S.jsxs)(s.Z,{align:"center",children:[e.buttonNode,e.cancelExportData?null:(0,S.jsx)(j.Z,{style:{marginLeft:6},onClick:function(){return l(!0)},children:"\u5bfc\u51fa\u6570\u636e"})]})})]}):null,(0,S.jsx)(O.ZP,{renderEmpty:H,children:(0,S.jsx)(P.Z,{size:e.size||"middle",rowKey:e.rowKey?e.rowKey:"id",dataSource:e.dataSource,components:{header:{cell:V}},columns:M,pagination:!1!==e.pagination&&(0,i.Z)({},e.pagination),scroll:D,loading:e.loading,onChange:e.onChange,rowSelection:e.rowSelection})})]})},D=t(43077),J=t.n(D),L=t(33405),K=t(17669),Y=t(33531),q=t(56713),A=t(20558),B=t(8718),G=t(48633),W=t(70332),U=t(16548),Q=t(88977),X=function(e){var n=Q.Z.useForm(),t=(0,c.Z)(n,1)[0],a=(0,o.useState)(),r=(0,c.Z)(a,2)[1];o.useCallback((function(){return r({})}),[]);(0,o.useEffect)((function(){e.formData&&t.setFieldsValue(e.formData)}),[e]);var i=(0,o.useState)({currentChange:{},allValues:{}}),l=(0,c.Z)(i,2),s=l[0],u=l[1];return(0,S.jsx)(m.Z,{destroyOnClose:!0,maskClosable:!1,width:e.width||680,visible:e.visible,title:e.title,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onCancel:function(){t.resetFields(),e.onCancel()},onOk:function(){console.log(t.getFieldsValue()),t.validateFields().then((function(n){e.onCreate(n,t)})).catch((function(e){}))},children:(0,S.jsx)(Z.Z,{spinning:e.loading,children:(0,S.jsx)(Q.Z,{onValuesChange:function(e,n){u({currentChange:e,allValues:n})},labelCol:{span:5},wrapperCol:{span:19},form:t,layout:"horizontal",name:"form_in_modal",children:e.children&&"[object Function]"===Object.prototype.toString.call(e.children)?e.children(t,s):e.children})})})},$=t(31202),ee=function(e,n){return $.Z.get("".concat(e||"","_info"),{params:{id:n}})},ne=function(e,n){return $.Z.get(e||"",{params:n})},te=function(e,n){return $.Z.get(e,{params:n})},ae=t(15861),re=t(87757),ie=t.n(re),ce=t(47474),oe=t(10007),le=t(28501),se=t(74030),ue=ce.Z.Option,de=function(e){var n=Q.Z.useForm(),t=(0,c.Z)(n,1)[0],r=(0,o.useState)(!1),l=(0,c.Z)(r,2),s=l[0],u=l[1],d=(0,o.useState)([]),f=(0,c.Z)(d,2),m=(f[0],f[1],function(e){return(e||[]).map((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},{indexKey:n})}))}),p=(0,o.useState)(m(e.params)),h=(0,c.Z)(p,2),Z=h[0],g=h[1],y=(0,o.useState)(m(e.params)),b=(0,c.Z)(y,2),_=b[0],k=b[1],w=(0,o.useState)(new Map),C=(0,c.Z)(w,2),N=C[0],O=C[1];(0,o.useEffect)((function(){if(e.values){var n=e.values.length?e.values:[{key:void 0,value:void 0}];t.setFieldsValue({group:n});for(var r=(0,a.Z)(_),i=0;i<r.length;i++)for(var c=0;c<n.length;c++){void 0!==n[c]&&n[c].key===r[i].name&&(r[i].used=!0)}k(r)}}),[e.values]),(0,o.useEffect)((function(){if(e.params&&e.params.length){var n=m(e.params);g(n);for(var t=N,a=0;a<n.length;a++){var r=n[a];t.set(r.name,r)}O(t)}}),[e.params]);var P=function(){var n=(0,ae.Z)(ie().mark((function n(t){var a,r;return ie().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log(t),a=t.group.filter((function(e){return!!e.key})),r=a.map((function(e){return{key:e.key,value:e.value}})),e.onChange(r);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),I=function(e){var n=t.getFieldValue(["group",e,"key"]);if(!n)return(0,S.jsx)(oe.Z,{style:{width:"65%"},onPressEnter:function(){return T()}});var a=N.get(n);if("input"===(null===a||void 0===a?void 0:a.type))return(0,S.jsx)(oe.Z,{style:{width:"65%"},defaultValue:a.defalutValue,placeholder:a.placeHolder,onPressEnter:function(){return T()}});if("select"===(null===a||void 0===a?void 0:a.type)){var r=(null===a||void 0===a?void 0:a.option)||[];return(0,S.jsx)(ce.Z,{style:{width:"65%"},dropdownMatchSelectWidth:500,showSearch:!0,mode:"label"===n?"multiple":void 0,optionFilterProp:"label",options:r.map((function(e){return{label:e.label,value:e.value}}))})}},T=function(){t.validateFields()};return(0,S.jsxs)(Q.Z,{className:"cmdb-mixsearch bg-title",form:t,onFinish:P,initialValues:{group:[{key:void 0,value:void 0}]},children:[(0,S.jsxs)(v.Z,{className:"cmdb-mixsearch-content",gutter:16,style:(0,i.Z)({marginLeft:0,marginRight:0},s?{height:70}:{height:"auto"}),children:[(0,S.jsx)(Q.Z.List,{name:"group",children:function(e,n){var r=n.add,i=n.remove;return(0,S.jsxs)(S.Fragment,{children:[e.map((function(e,n){return(0,S.jsx)(x.Z,{span:8,children:(0,S.jsxs)(v.Z,{align:"middle",gutter:8,children:[(0,S.jsx)(x.Z,{className:"cmdb-mixsearch-group",children:(0,S.jsxs)(oe.Z.Group,{compact:!0,children:[(0,S.jsx)(Q.Z.Item,{noStyle:!0,name:[e.name,"key"],rules:[{required:!1,message:"\u8bf7\u9009\u62e9key"}],children:(0,S.jsx)(ce.Z,{style:{width:"35%"},placeholder:"\u8bf7\u9009\u62e9",onChange:function(e){!function(e){for(var n=(0,a.Z)(_),r=(t.getFieldValue("group")||[]).filter((function(e){return!!e})).map((function(e){return e.key})),i=0;i<n.length;i++){var c=n[i];c.name===e?n[i].used=!0:r.includes(c.name)||(n[i].used=!1)}k(n)}(e)},children:_.map((function(e,n){return(0,S.jsx)(ue,{style:{display:e.used?"none":"inherit"},value:e.name,children:e.title||e.name},"mixSearch_".concat(e.name,"_").concat(n))}))})}),(0,S.jsx)(Q.Z.Item,{noStyle:!0,shouldUpdate:!0,name:[e.name,"value"],rules:[{required:!1,message:"\u8bf7\u586b\u5199value"}],children:I(n)})]})}),(0,S.jsx)(x.Z,{className:"cmdb-mixsearch-delete",onClick:function(){var e=(t.getFieldValue("group")||[]).map((function(e){return e?e.key:void 0})),r=(0,a.Z)(_);if(e[n])for(var c=0;c<r.length;c++){r[c].name===e[n]&&(r[c].used=!1)}k(r),i(n)},children:(0,S.jsx)(le.Z,{})})]})},"mixSearch_".concat(e.key,"_").concat(n))})),Z.length!==e.length&&(0,S.jsx)(x.Z,{className:"cmdb-mixsearch-add d-il",onClick:function(){r()},children:(0,S.jsx)(A.Z,{})})]})}}),(0,S.jsx)(x.Z,{flex:1,children:(0,S.jsx)(v.Z,{justify:"end",children:(0,S.jsx)(j.Z,{type:"primary",htmlType:"submit",children:"\u67e5\u8be2"})})})]}),(0,S.jsx)(v.Z,{className:"cmdb-mixsearch-collapsed",children:(0,S.jsx)(v.Z,{onClick:function(){u(!s)},justify:"center",align:"middle",children:s?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.Z,{children:"\u5c55\u5f00"}),(0,S.jsx)(x.Z,{children:(0,S.jsx)(K.Z,{})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.Z,{children:"\u6536\u8d77"}),(0,S.jsx)(x.Z,{children:(0,S.jsx)(se.Z,{})})]})})})]})},fe=t(81465);function me(e){var n=(0,W.s0)(),t=(0,W.TH)(),b=(0,o.useState)([]),_=(0,c.Z)(b,2),w=_[0],C=_[1],N=(0,o.useState)(!0),O=(0,c.Z)(N,2),P=O[0],I=O[1],T=(0,o.useState)(!1),E=(0,c.Z)(T,2),M=E[0],z=E[1],F=(0,o.useState)("true"===(0,U.jS)("isVisableAdd")||!1),H=(0,c.Z)(F,2),V=H[0],D=H[1],Q=(0,o.useState)(!1),ae=(0,c.Z)(Q,2),re=ae[0],ie=ae[1],ce=(0,o.useState)(!1),oe=(0,c.Z)(ce,2),le=oe[0],se=oe[1],ue=(0,o.useState)(!1),me=(0,c.Z)(ue,2),pe=me[0],he=me[1],Ze=(0,o.useState)(!1),ve=(0,c.Z)(Ze,2),xe=ve[0],je=ve[1],ge=(0,o.useState)([]),ye=(0,c.Z)(ge,2),be=ye[0],Se=ye[1],_e=(0,o.useState)({startTime:J()().subtract(1,"d").startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:J()().subtract(1,"d").endOf("day").format("YYYY-MM-DD HH:mm:ss")}),ke=(0,c.Z)(_e,2),we=(ke[0],ke[1],{current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:[20,50,100,500],showTotal:function(e){return"\u5171".concat(e,"\u6761")}}),Ce=(0,o.useState)(we),Ne=(0,c.Z)(Ce,2),Oe=Ne[0],Pe=Ne[1],Ie=(0,o.useState)([]),Te=(0,c.Z)(Ie,2),Ee=Te[0],Me=Te[1],ze=(0,o.useState)([]),Fe=(0,c.Z)(ze,2),He=Fe[0],Ve=Fe[1],Re=(0,o.useState)([]),De=(0,c.Z)(Re,2),Je=De[0],Le=De[1],Ke=(0,o.useRef)(Je),Ye=function(e){Ke.current=e,Le(e)},qe=(0,o.useState)([]),Ae=(0,c.Z)(qe,2),Be=Ae[0],Ge=Ae[1],We=(0,o.useState)([]),Ue=(0,c.Z)(We,2),Qe=Ue[0],Xe=Ue[1],$e=(0,o.useState)([]),en=(0,c.Z)($e,2),nn=en[0],tn=en[1],an=(0,o.useState)([]),rn=(0,c.Z)(an,2),cn=rn[0],on=rn[1],ln={};try{ln=JSON.parse((0,U.jS)("formData")||"{}")}catch(qt){}var sn=(0,o.useState)(ln),un=(0,c.Z)(sn,2),dn=un[0],fn=un[1],mn=(0,o.useState)({}),pn=(0,c.Z)(mn,2),hn=pn[0],Zn=pn[1],vn=(0,o.useState)({}),xn=(0,c.Z)(vn,2),jn=xn[0],gn=xn[1],yn=(0,o.useRef)(jn),bn=(0,o.useState)([]),Sn=(0,c.Z)(bn,2),_n=Sn[0],kn=Sn[1],wn=(0,o.useState)(1e3),Cn=(0,c.Z)(wn,2),Nn=Cn[0],On=Cn[1],Pn=(0,o.useState)([]),In=(0,c.Z)(Pn,2),Tn=In[0],En=In[1],Mn=(0,o.useState)({}),zn=(0,c.Z)(Mn,2),Fn=zn[0],Hn=zn[1],Vn=(0,o.useState)(),Rn=(0,c.Z)(Vn,2),Dn=Rn[0],Jn=Rn[1],Ln=(0,o.useState)(),Kn=(0,c.Z)(Ln,2),Yn=Kn[0],qn=Kn[1],An=(0,o.useRef)(Yn),Bn=(0,o.useState)(!1),Gn=(0,c.Z)(Bn,2),Wn=Gn[0],Un=Gn[1],Qn=(0,o.useState)(!1),Xn=(0,c.Z)(Qn,2),$n=Xn[0],et=Xn[1],nt=(0,o.useState)([]),tt=(0,c.Z)(nt,2),at=tt[0],rt=tt[1],it=(0,o.useState)([]),ct=(0,c.Z)(it,2),ot=ct[0],lt=ct[1],st=(0,o.useState)(),ut=(0,c.Z)(st,2),dt=ut[0],ft=ut[1],mt=(0,o.useState)(""),pt=(0,c.Z)(mt,2),ht=pt[0],Zt=pt[1],vt=(0,o.useState)(""),xt=(0,c.Z)(vt,2),jt=xt[0],gt=xt[1],yt=(0,o.useState)(),bt=(0,c.Z)(yt,2),St=bt[0],_t=bt[1],kt=(0,o.useState)(),wt=(0,c.Z)(kt,2),Ct=wt[0],Nt=wt[1],Ot=(0,o.useState)(!1),Pt=(0,c.Z)(Ot,2),It=(Pt[0],Pt[1],(0,o.useState)([])),Tt=(0,c.Z)(It,2),Et=Tt[0],Mt=Tt[1],zt=(0,o.useState)(""),Ft=(0,c.Z)(zt,2),Ht=Ft[0],Vt=Ft[1],Rt={pageConf:we,params:[],paramsMap:Fn,sorter:void 0};(0,o.useEffect)((function(){Vt((0,U.W9)())}),[]),(0,o.useEffect)((function(){e&&e.disable&&n("/404")}),[]);var Dt=function e(n,t,a){return n.map((function(n,r){var c=n["ui-type"]||"input";"select2"===c&&(c="select");var o=n.label||t[n.name],l=(n.validators||[]).map((function(e){if("select"===c)return"DataRequired"===e.type?{required:!0,message:"\u8bf7\u9009\u62e9".concat(o)}:void 0;switch(e.type){case"DataRequired":return{required:!0,message:"\u8bf7\u8f93\u5165".concat(o)};case"Regexp":return{pattern:new RegExp("".concat(e.regex)),message:"\u8bf7\u6309\u6b63\u786e\u7684\u89c4\u5219\u8f93\u5165"};case"Length":return{min:e.min||0,max:e.max,message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u957f\u5ea6"};default:return}})).filter((function(e){return!!e})),s=e(n.info||[],t,a);return{label:o,type:c,rules:l,list:s,name:n.name,disable:n.disable,description:n.description||a[n.name]||void 0,required:n.required,defaultValue:""===n.default?void 0:n.default,multiple:n["ui-type"]&&"select2"===n["ui-type"],options:(n.values||[]).map((function(e){return{label:e.value,value:e.id}})),data:(0,i.Z)({},n)}}))};(0,o.useEffect)((function(){var o=(0,U.jS)("targetId"),p=o?"/dimension_remote_table_modelview/".concat(o,"/api/"):null===e||void 0===e?void 0:e.url;z(!0),ee(p).then((function(o){var p=o.data,h=p.list_columns,Z=p.label_columns,v=p.filters,x=p.add_columns,j=p.edit_columns,g=p.permissions,y=p.description_columns,b=p.add_fieldsets,_=p.edit_fieldsets,k=p.help_url,w=p.order_columns,C=p.action,N=p.route_base,O=p.column_related,P=p.primary_key,I=p.label_title,T=p.cols_width,E=p.import_data,M=p.download_data,F=p.list_ui_type,H=p.list_ui_args,V=(null===e||void 0===e?void 0:e.related)||g.includes("can_show")||g.includes("can_edit")||g.includes("can_delete"),R=localStorage.getItem("tablebox_".concat(t.pathname)),D=JSON.parse(R||"[]").reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.dataIndex,n.width))}),{}),J=Object.entries(O||{}).reduce((function(e,n){var t=(0,c.Z)(n,2),o=(t[0],t[1]);return[].concat((0,a.Z)(e),[{dep:o.src_columns,effect:o.des_columns.join(""),effectOption:o.related.reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},(0,fe.a)(n.src_value),n.des_value.map((function(e){return{label:e,value:e}}))))}),{})}])}),[]),Y=h.map((function(e){return{title:Z[e]||e,dataIndex:e,key:e,sorter:w.includes(e)?function(n,t){return n[e]-t[e]}:void 0,render:function(n,t){var r;if(void 0===n||""===n)return"-";if(T[e]&&-1!==(null===(r=T[e].type)||void 0===r?void 0:r.indexOf("ellip")))return(0,S.jsx)(l.Z,{title:(0,S.jsx)("span",{className:"tips-content",dangerouslySetInnerHTML:{__html:n}}),placement:"topLeft",children:(0,S.jsx)("div",{className:T[e].type,dangerouslySetInnerHTML:{__html:n}})});if("[object Object]"===Object.prototype.toString.call(n)){var i=Object.entries(n).reduce((function(e,n){var t=(0,c.Z)(n,2),r=t[0],i=t[1];return[].concat((0,a.Z)(e),[{label:r,value:i}])}),[]);return i.length?(0,S.jsx)("div",{style:{overflow:"auto",maxHeight:100},children:i.map((function(e,n){return(0,S.jsxs)("div",{children:[Z[e.label]||e.label,":",e.value]},"table_itemvalue_".concat(n))}))}):"-"}return(0,S.jsx)("div",{style:{overflow:"auto",maxHeight:100},dangerouslySetInnerHTML:{__html:n}})},width:D[e]||T[e]&&T[e].width||100}})),q=Object.entries(C||{}).reduce((function(e,n){var t=(0,c.Z)(n,2),r=(t[0],t[1]);return[].concat((0,a.Z)(e),[(0,i.Z)({},r)])}),[]),A=q.filter((function(e){return!!e.multiple})),B=q.filter((function(e){return!!e.single})),G={title:"\u64cd\u4f5c",width:80,dataIndex:"handle",key:"handle",align:"right",fixed:"right",render:function(a,r){var c;return(0,S.jsx)(s.Z,{size:"middle",children:V?(0,S.jsx)(u.Z,{overlay:(0,S.jsxs)(d.Z,{children:[g.includes("can_show")?(0,S.jsx)(d.Z.Item,{children:(0,S.jsx)("div",{className:"link",onClick:function(){je(!0),Lt(r[P])},children:"\u8be6\u60c5"})}):null,g.includes("can_edit")?(0,S.jsx)(d.Z.Item,{children:(0,S.jsx)("div",{className:"link",onClick:function(){se(!0),ee(N,r[P]).then((function(e){var n=e.data,t=n.edit_columns,a=n.label_columns,i=n.description_columns,c=Dt(t,a,i),o=_.map((function(e){var n=e.fields.map((function(e){return ie[e]})).filter((function(e){return!!e}));return{group:e.group,expanded:e.expanded,config:Dt(n,a,i)}}));Xe(c),on(o),Lt(r[P])})).catch((function(){f.ZP.warn("\u7528\u6237\u6ca1\u6709\u4fee\u6539\u6743\u9650")}))},children:"\u4fee\u6539"})}):null,g.includes("can_delete")?(0,S.jsx)(d.Z.Item,{children:(0,S.jsx)("div",{className:"c-fail cp",onClick:function(){m.Z.confirm({title:"\u5220\u9664",icon:(0,S.jsx)(L.Z,{}),content:"\u786e\u5b9a\u5220\u9664?",okText:"\u786e\u8ba4\u5220\u9664",cancelText:"\u53d6\u6d88",okButtonProps:{danger:!0},onOk:function(){return new Promise((function(e,n){(function(e,n){return $.Z.delete(e||"",{params:n})})("".concat(N).concat(r[P])).then((function(n){e("")})).catch((function(e){n()}))})).then((function(e){f.ZP.success("\u5220\u9664\u6210\u529f"),Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:Oe,params:Ke.current,paramsMap:v}))})).catch((function(){f.ZP.error("\u5220\u9664\u5931\u8d25")}))},onCancel:function(){}})},children:"\u5220\u9664"})}):null,null===e||void 0===e||null===(c=e.related)||void 0===c?void 0:c.map((function(e,a){return(0,S.jsx)(d.Z.Item,{children:(0,S.jsx)("div",{className:"link",onClick:function(){n("".concat(t.pathname,"/").concat(e.name,"?id=").concat(r[P]))},children:e.title})},"moreAction_".concat(a))})),!!B.length&&B.map((function(e,n){return(0,S.jsx)(d.Z.Item,{children:(0,S.jsx)("div",{className:"link",onClick:function(){m.Z.confirm({title:e.confirmation,icon:(0,S.jsx)(L.Z,{}),content:"",okText:"\u786e\u8ba4".concat(e.confirmation),cancelText:"\u53d6\u6d88",onOk:function(){return new Promise((function(n,t){(function(e){return $.Z.get(e||"")})("".concat(N,"action/").concat(e.name,"/").concat(r[P])).then((function(e){n(e)})).catch((function(e){t(e)}))})).then((function(e){f.ZP.success("\u64cd\u4f5c\u6210\u529f"),e.data.result.link&&window.open(e.data.result.link,"bank"),Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:Oe,params:Ke.current,paramsMap:v}))})).catch((function(){f.ZP.error("\u64cd\u4f5c\u5931\u8d25")}))},onCancel:function(){}})},children:e.text})},"table_action_".concat(n))}))]}),children:(0,S.jsxs)("div",{className:"link",children:["\u66f4\u591a",(0,S.jsx)(K.Z,{})]})}):null})}},W=(0,a.Z)(Y);V&&W.push(G);var Q=x.reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.name,n))}),{});if(ln&&Object.keys(ln).length){var X=(Object.keys(ln)||[]).filter((function(e){return ln[e]&&Q[e]&&Q[e].retry_info})),ne=X.length;if(X.length){var ae=ln;for(var re in ae){if(Object.prototype.hasOwnProperty.call(ae,re))void 0===ae[re]&&delete ae[re]}!function e(n){ne-=1,te("".concat(N,"_info"),{exist_add_args:n}).then((function(n){var t=n.data,a=t.add_columns,c=t.label_columns,o=t.description_columns,l=t.add_fieldsets,s=a.reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.name,n))}),{}),u=Dt(a,c,o),d=l.map((function(e){var n=e.fields.map((function(e){return s[e]})).filter((function(e){return!!e}));return{group:e.group,expanded:e.expanded,config:Dt(n,c,o)}})),f=a.filter((function(e){return""!==e.default})).map((function(e){return(0,r.Z)({},e.name,e.default)})).reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),n)}),{});if(fn(f),Ge(u),tn(d),ne){var m=JSON.stringify(f);e(m)}})).catch((function(e){f.ZP.error("\u5b57\u6bb5\u5207\u6362\u9519\u8bef")})).finally((function(){z(!1)}))}(JSON.stringify(ae))}}var ie=j.reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.name,n))}),{});j.forEach((function(e){"list"===e["ui-type"]&&e.info.forEach((function(e){ie[e.name]=e}))}));var ce=Dt(x,Z,y),oe=b.map((function(e){var n=e.fields.map((function(e){return Q[e]})).filter((function(e){return!!e}));return{group:e.group,expanded:e.expanded,config:Dt(n,Z,y)}})),le=Object.entries(v).reduce((function(e,n){var t=(0,c.Z)(n,2),r=t[0],i=t[1];return[].concat((0,a.Z)(e),[{name:r,type:i["ui-type"]||"input",title:Z[r],oprList:i.filter.map((function(e){return e.operator})),defalutValue:""===i.default?void 0:i.default,option:i.values?i.values.map((function(e){return{label:e.value,value:e.id}})):void 0}])}),[]),ue=Object.entries(v).reduce((function(e,n){var t=(0,c.Z)(n,2),r=t[0],i=t[1];return[].concat((0,a.Z)(e),[{key:r,value:i.default}])}),[]).filter((function(e){return e.value})),de=JSON.parse(localStorage.getItem("filter_".concat(t.pathname).concat(t.search))||"[]"),me=void 0;if((0,U.jS)("filter"))try{me=JSON.parse((0,U.jS)("filter")||"[]")}catch(ve){f.ZP.error("filter\u89e3\u6790\u5f02\u5e38")}var pe,he=me||de;he&&he.length&&(ue=he),Mt(h),_t(F),Nt(H),et(M),Un(E),gt(I),Zt(P),rt(J),lt(A),pe=N,An.current=pe,qn(pe),Zn(ie),Hn(v),Me(W),Ve(le),Ge(ce),tn(oe),function(e){yn.current=e,gn(e)}(Z),En(g);var Ze=R?W.reduce((function(e,n){return e+n.width||100}),0)+80:100*W.length+80+80;On(Ze),Jn(k),Ye(ue),Jt({pageConf:we,params:ue,paramsMap:v,sorter:void 0})})).catch((function(e){console.log(e)})).finally((function(){I(!1),z(!1)}))}),[]);var Jt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pageConf:we,params:Je,paramsMap:Fn,sorter:void 0},t=n.pageConf,r=n.params,c=n.paramsMap,o=n.sorter;I(!0);var l=void 0,s=(0,U.jS)("id");l=JSON.stringify((0,i.Z)({str_related:1,filters:[s?{col:null===e||void 0===e?void 0:e.model_name,opr:"rel_o_m",value:+s}:void 0].concat((0,a.Z)(r.filter((function(e){return void 0!==e.value})).map((function(e){for(var n="",t=["rel_o_m","ct","eq"],a=c[e.key].filter.map((function(e){return e.operator}))||[],r=0;r<t.length;r++){var i=t[r];if(a.includes(i)){n=i;break}}return{col:e.key,opr:n,value:e.value}})))).filter((function(e){return!!e})),page:(t.current||1)-1,page_size:t.pageSize||10},o)),ne(An.current,{form_data:l}).then((function(e){var n=e.data.result,a=n.count,r=n.data;C(r),Se([]),Pe((0,i.Z)((0,i.Z)((0,i.Z)({},we),t),{},{total:a})),ft(o)})).catch((function(e){console.log(e)})).finally((function(){return I(!1)}))},Lt=function(e){var n;he(!0),kn([]),(n="".concat(An.current).concat(e),$.Z.get("".concat(n),{params:{form_data:{str_related:1}}})).then((function(e){var n=e.data.result,t=[],a=function(e){return"[object Object]"===Object.prototype.toString.call(e)?e.last_name:e};Object.keys(n).forEach((function(e){t.push({label:yn.current[e]||e,value:a(n[e]),key:e})})),kn(t)})).catch((function(e){})).finally((function(){he(!1)}))},Kt=function(e){be.length?m.Z.confirm({title:e.confirmation,icon:(0,S.jsx)(L.Z,{}),content:"",okText:"\u786e\u8ba4".concat(e.confirmation),cancelText:"\u53d6\u6d88",onOk:function(){return new Promise((function(n,t){var a,r;(a="".concat(An.current,"multi_action/").concat(e.name),r={ids:be.map((function(e){return JSON.parse(e||"{}")[ht]}))},$.Z.post(a||"",r)).then((function(e){n("")})).catch((function(e){t()}))})).then((function(e){f.ZP.success("\u64cd\u4f5c\u6210\u529f"),Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:Oe,params:Je,sorter:dt,paramsMap:Fn}))})).catch((function(){f.ZP.error("\u64cd\u4f5c\u5931\u8d25")}))},onCancel:function(){}}):f.ZP.warn("\u8bf7\u5148\u9009\u62e9")},Yt={name:"csv_file",maxCount:1,action:"".concat(Yn,"upload/"),headers:{authorization:"authorization-text"},beforeUpload:function(e){var n=-1!==e.name.indexOf(".csv");return n||f.ZP.error("".concat(e.name," \u5e76\u4e0d\u662fcsv\u6587\u4ef6")),n||p.Z.LIST_IGNORE},onChange:function(e){"done"===e.file.status?h.Z.success({message:"\u5bfc\u5165\u6210\u529f",description:JSON.stringify(e.file.response)}):"error"===e.file.status&&h.Z.error({message:"\u5bfc\u5165\u5931\u8d25",description:JSON.stringify(e.file.response)})}};return(0,S.jsxs)("div",{className:"fade-in",children:[(0,S.jsx)(X,{title:"\u6dfb\u52a0".concat(jt),width:1500,formData:dn,loading:M,visible:V,onCancel:function(){D(!1)},onCreate:function(e,n){for(var t in z(!0),e)if(Object.prototype.hasOwnProperty.call(e,t)){var a=e[t];if(Array.isArray(a)){if(a[0]&&"[object Object]"===Object.prototype.toString.call(a[0]))continue;e[t]=e[t].join(",")}}var r,c;(r=An.current,c=e,$.Z.post(r||"",c)).then((function(e){f.ZP.success("\u6dfb\u52a0".concat(jt,"\u6210\u529f")),n.resetFields(),D(!1),Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:Oe,params:Je,sorter:dt,paramsMap:Fn}))})).catch((function(e){f.ZP.error("\u6dfb\u52a0".concat(jt,"\u5931\u8d25"))})).finally((function(){z(!1)}))},children:function(e,n){return(0,S.jsx)(fe.Z,{form:e,onRetryInfoChange:function(n){z(!0);var t=e.getFieldsValue();for(var a in t){if(Object.prototype.hasOwnProperty.call(t,a))void 0===t[a]&&delete t[a]}var c=JSON.stringify(t);e.resetFields(),te("".concat(An.current,"_info"),{exist_add_args:c}).then((function(n){var t=n.data,a=t.add_columns,c=t.label_columns,o=t.description_columns,l=t.add_fieldsets,s=a.reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.name,n))}),{}),u=Dt(a,c,o),d=l.map((function(e){var n=e.fields.map((function(e){return s[e]})).filter((function(e){return!!e}));return{group:e.group,expanded:e.expanded,config:Dt(n,c,o)}})),f=a.filter((function(e){return""!==e.default})).map((function(e){return(0,r.Z)({},e.name,e.default)})).reduce((function(e,n){return(0,i.Z)((0,i.Z)({},e),n)}),{});e.setFieldsValue(f),Ge(u),tn(d)})).catch((function(e){f.ZP.error("\u5b57\u6bb5\u5207\u6362\u9519\u8bef")})).finally((function(){z(!1)}))},formChangeRes:n,linkageConfig:at,config:Be,configGroup:nn})}}),(0,S.jsx)(X,{title:"\u4fee\u6539".concat(jt),width:1500,formData:_n.reduce((function(e,n){if("select"===(hn[n.key]||{})["ui-type"]){var t=n.value,a=(hn[n.key]||{}).values||[],c=a.map((function(e){return e.value})).indexOf(n.value);return~c&&(t=a[c].id),(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.key,t))}if("select2"===(hn[n.key]||{})["ui-type"])return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.key,(n.value||"").split(",")));if("datePicker"===(hn[n.key]||{})["ui-type"]){var o=n.value;return o=J()(o),(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.key,o))}if("list"===(hn[n.key]||{})["ui-type"]){var l=(n.value||[]).map((function(e){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var t=e[n];"datePicker"===(hn[n]||{})["ui-type"]&&(e[n]=J()(t))}return e}));return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.key,l))}return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},n.key,n.value))}),{}),loading:re||pe,visible:le,onCancel:function(){se(!1)},onCreate:function(e){for(var n in ie(!0),kn([]),e)if(Object.prototype.hasOwnProperty.call(e,n)){var t=e[n];if(Array.isArray(t)){if(t[0]&&"[object Object]"===Object.prototype.toString.call(t[0]))continue;e[n]=e[n].join(",")}}var a,r;(a="".concat(An.current).concat(e[ht]),r=e,$.Z.put(a||"",r)).then((function(e){f.ZP.success("\u66f4\u65b0".concat(jt,"\u6210\u529f")),se(!1),Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:Oe,params:Je,sorter:dt,paramsMap:Fn}))})).catch((function(e){f.ZP.error("\u66f4\u65b0".concat(jt,"\u5931\u8d25"))})).finally((function(){ie(!1)}))},children:function(e){return(0,S.jsx)(fe.Z,{form:e,primaryKey:ht,config:Qe,linkageConfig:at,configGroup:cn})}}),(0,S.jsx)(m.Z,{title:"".concat(jt,"\u8be6\u60c5"),visible:xe,footer:null,width:800,destroyOnClose:!0,onCancel:function(){je(!1)},children:(0,S.jsx)(Z.Z,{spinning:pe,children:(0,S.jsx)("div",{className:"pb32",style:{minHeight:300},children:_n.map((function(e,n){return(0,S.jsxs)(v.Z,{className:"mb16",children:[(0,S.jsx)(x.Z,{span:6,children:(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsxs)("strong",{children:[e.label,"\uff1a"]})})}),(0,S.jsx)(x.Z,{span:18,children:(0,S.jsx)("pre",{style:{whiteSpace:"break-spaces"},dangerouslySetInnerHTML:{__html:function(){var n=e.value;if("[object Object]"===Object.prototype.toString.call(e.value)||"[object Array]"===Object.prototype.toString.call(e.value))try{n=JSON.stringify(e.value)}catch(t){}return n}()}})})]},"dataDetail_".concat(n))}))})})}),(0,S.jsx)(k,{title:(0,S.jsxs)(S.Fragment,{children:[null!==e&&void 0!==e&&e.isSubRoute||(0,U.jS)("targetId")?(0,S.jsxs)(j.Z,{className:"mr16",onClick:function(){n("/data/metadata/metadata_dimension"),window.location.reload()},children:[(0,S.jsx)(Y.Z,{}),"\u8fd4\u56de"]}):null,(0,S.jsx)("span",{children:jt})]}),breadcrumbs:((null===e||void 0===e?void 0:e.breadcrumbs)||[]).map((function(n,t){return(0,S.jsxs)("span",{className:"c-hint-b fs12",children:["/",(0,S.jsx)("span",{className:"plr2",children:n})]},"templateTitle_".concat(null===e||void 0===e?void 0:e.name,"_").concat(t))})),children:Dn?(0,S.jsxs)("div",{className:"link",children:[(0,S.jsx)("span",{className:"pr4",onClick:function(){window.open(Dn,"blank")},children:"\u5e2e\u52a9\u94fe\u63a5"}),(0,S.jsx)(q.Z,{})]}):null}),(0,S.jsxs)(y.VY,{className:"appmgmt-content bg-title",children:[!!He.length&&(0,S.jsx)(de,{values:Je,params:He,onChange:function(e){localStorage.setItem("filter_".concat(t.pathname).concat(t.search),JSON.stringify(e)),Ye(e),Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:we,params:e,sorter:dt,paramsMap:Fn}))}}),(0,S.jsx)("div",{className:"m16",children:"card"!==St?(0,S.jsx)(R,{cancelExportData:!0,tableKey:"tablebox_".concat(t.pathname),titleNode:(0,S.jsxs)(x.Z,{className:"tablebox-title",children:[jt,"\u5217\u8868"]}),buttonNode:(0,S.jsxs)("div",{className:"d-f ac",children:[Tn.includes("can_add")?(0,S.jsxs)(j.Z,{className:"mr16",type:"primary",onClick:function(){return D(!0)},children:["\u6dfb\u52a0",jt,(0,S.jsx)(A.Z,{})]}):null,(0,S.jsx)("div",{children:(0,S.jsx)(u.Z,{overlay:(0,S.jsx)(d.Z,{children:ot.map((function(e,n){return(0,S.jsx)(d.Z.Item,{children:(0,S.jsx)("span",{className:"link",onClick:function(){return Kt(e)},children:"\u6279\u91cf".concat(e.text)})},"table_muliple_".concat(n))}))}),children:(0,S.jsxs)(j.Z,{children:["\u6279\u91cf\u64cd\u4f5c ",(0,S.jsx)(K.Z,{})]})})}),Wn?(0,S.jsx)("div",{className:"d-f ml16",children:(0,S.jsx)(l.Z,{color:"#fff",title:(0,S.jsxs)("span",{className:"tips-content-b",children:["\u6ce8\u610f\uff1acsv\u9017\u53f7\u5206\u9694\uff0c\u7b2c\u4e00\u884c\u4e3a\u5217\u7684\u82f1\u6587\u540d ",(0,S.jsx)("span",{className:"link",onClick:function(){window.open("".concat(window.location.origin).concat(An.current,"download_template"))},children:"\u4e0b\u8f7d\u5bfc\u5165\u6a21\u677f"})]}),placement:"topLeft",children:(0,S.jsx)(p.Z,(0,i.Z)((0,i.Z)({},Yt),{},{children:(0,S.jsx)(j.Z,{className:"",icon:(0,S.jsx)(B.Z,{}),children:"\u6279\u91cf\u5bfc\u5165\u6570\u636e"})}))})}):null,$n?(0,S.jsxs)(j.Z,{className:"ml16",onClick:function(){m.Z.confirm({title:"\u5bfc\u51fa\u6570\u636e",icon:(0,S.jsx)(L.Z,{}),content:"",okText:"\u786e\u8ba4\u5bfc\u51fa\u6570\u636e",cancelText:"\u53d6\u6d88",onOk:function(){window.open("".concat(window.location.origin).concat(An.current,"download")),f.ZP.success("\u5bfc\u51fa\u6210\u529f")},onCancel:function(){}})},children:["\u6279\u91cf\u5bfc\u51fa  ",(0,S.jsx)(G.Z,{})]}):null]}),rowKey:function(e){return JSON.stringify(e)},columns:Ee,loading:P,pagination:Oe,dataSource:w,onChange:function(e,n,t){var a=t.order?{order_column:t.columnKey,order_direction:"ascend"===t.order?"asc":"desc"}:void 0;Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:e,params:Je,paramsMap:Fn,sorter:a}))},rowSelection:{type:"checkbox",fixed:"left",columnWidth:80,selectedRowKeys:be,onChange:function(e){Se(e)}},scroll:{x:Nn,y:Ht}}):(0,S.jsxs)("div",{className:"bg-w p16",children:[(0,S.jsx)("div",{className:"d-f fw",children:w.map((function(e,n){return(0,S.jsx)("div",{style:{overflowY:"auto",width:null===Ct||void 0===Ct?void 0:Ct.card_width,height:null===Ct||void 0===Ct?void 0:Ct.card_height},className:"card-row mr16 mb16",children:Object.keys(e).map((function(t,a){return Et.includes(t)?(0,S.jsx)("div",{style:{wordBreak:"break-all"},dangerouslySetInnerHTML:{__html:e[t]}},"row".concat(n).concat(a)):null}))},"card".concat(n))}))}),(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsx)(g.Z,(0,i.Z)((0,i.Z)({},Oe),{},{onChange:function(e,n){Jt((0,i.Z)((0,i.Z)({},Rt),{},{pageConf:(0,i.Z)((0,i.Z)({},Oe),{},{current:e,pageSize:n}),params:Je,paramsMap:Fn}))}}))})]})})]})]})}},602:function(e,n,t){e.exports=t.p+"static/media/emptyBg.15fdf5f39309784ac66e.png"}}]);
//# sourceMappingURL=535.6307a6dc.chunk.js.map